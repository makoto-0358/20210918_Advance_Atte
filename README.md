## アプリケーション名

Atte(アット)

## アプリケーション概要

ある企業の勤怠管理システムです。

## URL

http://pure-caverns-88245.herokuapp.com/

## 利用方法

-   会員登録：名前、メールアドレス、パスワードを登録します。
-   登録したメールアドレスへ「メールアドレスの確認」メールが届くので、そのメール内にある「メールアドレスの確認」ボタンをクリックしていただくことでご利用いただける様になります。
-   ログインにはメールアドレスとパスワードが必要です。
-   パスワードをお忘れの際は、ログイン画面の「パスワードをお忘れの方はこちら」からパスワードの再設定ができます。
-   その後の画面で登録したメールアドレスを入力後、「パスワードの再設定リンクの送信」ボタンをクリックすると、そのメールアドレス宛に「パスワードの再設定通知メール」が届きます。
-   メールが届いてから 60 分以内に「パスワードの再設定」ボタンをクリックしていただくとパスワードの再設定画面が表示されるので、必要事項を入力後、「パスワードの再設定」をクリックするとパスワードの再設定が完了します。
-   パスワードの再設定後、ログイン画面が表示されるので必要事項を入力してログインいただけます。
-   ログイン中、右上の「ログアウト」をクリックするとログアウトします。
-   ホーム画面:現在の状況に合わせて、勤務開始、勤務終了、休憩開始、休憩終了の各ボタンをクリックします。
-   日付一覧ページ:該当日付における出勤状況の一覧を確認できます。
-   勤怠一覧ページ:ログイン中のユーザーの出勤状況の一覧を確認できます。

## 目指した課題解決

勤務状況の確認を人事評価に活用します。

## ページ

| パス            | 内容             |
| --------------- | ---------------- |
| /               | 打刻ページ       |
| /register       | 会員登録ページ   |
| /login          | ログインページ   |
| /attendance     | 日付別勤怠ページ |
| /userattendance | ユーザーページ   |

## 要件定義

| No. | 機能                     | 目的                                                                                                            | 内容                                                                                                                                                                                                                                                                                                                                                   |
| --- | ------------------------ | --------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | 設計                     | 目的                                                                                                            | 詳細                                                                                                                                                                                                                                                                                                                                                   |
| 2   | 会員登録機能             | 会員登録することでメール認証機能が利用できるようになります。                                                    | 名前、メールアドレス、パスワードを登録します。                                                                                                                                                                                                                                                                                                         |
| 3   | メール認証機能           | メール認証をすることで各種機能を使用可能となります。                                                            | 会員登録したメールアドレスへ送られてきたメール内のボタンをクリックすることでメール認証が完了します。                                                                                                                                                                                                                                                   |
| 4   | パスワード再設定機能     | パスワードをお忘れの際に、再設定できます。                                                                      | ログイン画面から「パスワードをお忘れの方はこちら」をクリック後、メール認証機能同様の手続きでパスワードの再設定をします。                                                                                                                                                                                                                               |
| 5   | ログイン、ログアウト機能 | メール認証済みの会員のみ利用可能です。                                                                          | メール認証が必要です。                                                                                                                                                                                                                                                                                                                                 |
| 6   | 勤務開始、勤務終了       | 勤務開始、勤務終了時刻の記録及び勤務時間の計算に使用します。                                                    | 勤務中でなければ勤務開始ボタンのみ押せる様になっており、勤務終了ボタンは勤務中のみ押せる様になっています。勤務終了後であれば、同じ日でも再び勤務開始ボタンを押すことはできます。出勤した時点を基準として関連する時刻データが記録されますので、出勤している状態で日を跨いだ場合、その日最初の操作では勤務開始ボタンは押せない様になっています。         |
| 7   | 休憩開始、休憩終了       | 休憩開始、休憩終了時刻の記録及び休憩時間の計算に使用します。                                                    | 休憩開始ボタン、休憩終了ボタンは勤務中のみ押せる様になっています。一度の出勤内では何度でも休憩することが可能です。休憩中でなければ休憩開始ボタンのみ押せる様になっており、休憩中であれば休憩終了ボタンのみ押せる様になっています。                                                                                                                     |
| 8   | 日付別勤怠情報取得       | 特定日付における 1 出勤毎に、会員名と勤務開始及び勤務終了時刻、休憩時間、勤務時間を表示します。                 | 休憩時間は 1 出勤記録内における総休憩時間を示し、勤務時間は 1 出勤記録内における総休憩時間を除いた総時間を示します。出勤した時点を基準として関連する時刻データが記録されますので、出勤している状態で日を跨いだ出勤記録は勤務開始ボタンを押した日のものとして扱っています。そのため、表示上は勤務開始時刻よりも勤務終了時刻が先になることがあり得ます。 |
| 9   | ユーザー別勤怠情報取得   | ログイン中のユーザーにおける 1 出勤毎に、勤務開始日と勤務開始及び勤務終了時刻、休憩時間、勤務時間を表示します。 | 休憩時間は 1 出勤記録内における総休憩時間を示し、勤務時間は 1 出勤記録内における総休憩時間を除いた総時間を示します。出勤した時点を基準として関連する時刻データが記録されますので、出勤している状態で日を跨いだ出勤記録は勤務開始ボタンを押した日のものとして扱っています。そのため、表示上は勤務開始時刻よりも勤務終了時刻が先になることがあり得ます。 |
| 10  | ページネーション         | 目的                                                                                                            | 特定日付における勤務情報を 5 件ずつ表示します。                                                                                                                                                                                                                                                                                                        |
| 11  | 現在の状況表示           | 現在勤務中か、休憩中かが分かる様に表示されます。                                                                | 勤務中であれば「勤務中です。」勤務中でなければ「勤務中ではありません。」、休憩中であれば「休憩中です。」、休憩中でなければ「休憩中ではありません。」が表示されます。勤務中の場合は休憩との組み合わせで表示されますが、勤務中でない場合は「勤務中ではありません。」のみが表示されます。                                                                 |

## データベース設計

![](ER.drawio.png)

## 開発環境

| 名称             | バージョン   |
| ---------------- | ------------ |
| Docker           | 20.10.13     |
| Composer         | 2.1.3        |
| Laravel          | 8.58.0       |
| MySQL(Docker 内) | 8.0          |
| PHP(Docker 内)   | 7.4          |
| Google Chrome    | 96.0.4664.55 |

## 動作確認済み

| PC/SP | 名称          | バージョン        |
| ----- | ------------- | ----------------- |
| PC    | Google Chrome | 96.0.4664.55      |
| PC    | Safari        | 15.1              |
| PC    | Firefox       | 94.0.1(64 ビット) |
| SP    | iOS           | 15.1              |

## 環境構築手順(以下 Mac の場合)

### Docker のインストール

-   [こちら](https://www.docker.com)から Docker の web サイトへ移動し、右上の Get Started をクリックするとダウンロード画面が表示されます。
-   左側の Docker Desktop の Download for Mac をクリックするとダウンロードが開始されます。
-   Docker .dmg ファイルのダウンロードが完了したらダブルクリくを行い、左側の Docker を Applications フォルダにドラッグ＆ドロップしてください。
-   メニューの移動からアプリケーションを選択すると Docker がインストールされていると思うので Docker をダブルクリックで起動してください。ファイルを開くための確-認画面が表示されるので、開くをクリックしてください。
-   Docker Desktop を起動するための権限が必要となるため、パスワードを入力する必要があります。そのまま OK ボタンをクリックしてください。
-   パスワード入力画面が表示されるので、OS のユーザ名、パスワードを入力してください。
-   サービスアグリーメントの画面が表示されるので、内容に問題がない場合は I accept the terms にチェックを行い Accept ボタンをクリックしてください。Docker が起動されます。

### GitHub から Clone

```
$ git clone https://github.com/makoto-0358/20210918_Advance_Atte.git

```

### Composer パッケージのインストール

```

$ cd 20210918_Advance_Atte

```

```

$ docker run --rm \ -u "$(id -u):$(id -g)" \ -v $(pwd):/var/www/html \ -w /var/www/html \ laravelsail/php80-composer:latest \ bash -c "composer create-project laravel/laravel:^8.0 src && cd src && php ./artisan sail:install --with=mysql

```

### .env の設定(Gmail を使用した例)

```

APP_NAME=Atte
APP_ENV=local
APP_URL=http://localhost
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=Atteddb
DB_USERNAME=root
DB_PASSWORD=password

MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=465
MAIL_USERNAME=送信元メールアドレス(hoge@gmail.comの形式)
MAIL_PASSWORD=アプリパスワード(後述)
MAIL_ENCRYPTION=ssl
MAIL_FROM_NAME="${APP_NAME}"

```

### 2 段階認証設定によるメールの送信 (アプリパスワードの設定)

-   (Google アカウントに移動)[https://myaccount.google.com]し、先の.env ファイルの MAIL_USERNAME のアカウントでログインする。
-   画面左側のねびゲーションパネルにある「セキュリティ」をクリック。
-   「Google へのログイン」にある「2 段階認証プロセス」をクリックして機能をオンにする。
-   その後は画面指示に従い設定を行う。
-   設定が完了すると 2 段階認証プロセスがオンになり、「Google へのログイン」の所に「アプリパスワード」という項目が表示される。
-   「アプリパスワード」を選択し、アプリの選択をメールにし、デバイスの選択には任意の名前をつけて「生成」ボタンをクリックする。
-   16 桁のパスワードが表示されるので、先の.env ファイルの USER \_PASSWORD にこの 16 桁のパスワードを設定する。

### Docker コンテナの起動

```

$ ./vendor/bin/sail up -d

```

### Node.js のパッケージをインストール

```

$ ./vendor/bin/sail npm install
$ ./vendor/bin/sail npm run dev

```

### Laravel の　 APP_KEY 生成

```

$ ./vendor/bin/sail aitisan key:genarate

```

### マイグレーション実行

```

$ ./vendor/bin/sail artisan migrate

```

ブラウザで http://localhost を開く。
